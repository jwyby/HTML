<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>侧边栏倒计时 - 最终优化版</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'card-bg': '#ffffff',
                        'theme-main': '#4aa09a',       /* 主题色 */
                        'theme-sub': 'rgba(74, 160, 154, 0.15)', /* 主题浅色背景 */
                        'text-main': '#1f2937',        /* 主要文字 */
                        'text-sub': '#6b7280',         /* 次要文字 */
                        'text-muted': '#9ca3af',       /*以此文字 */
                    },
                    fontFamily: {
                        sans: ['"PingFang SC"', '"Hiragino Sans GB"', '"Microsoft YaHei"', 'sans-serif'],
                        display: ['"DIN Alternate"', '"Roboto Condensed"', 'Arial', 'sans-serif'], /* 数字字体 */
                    },
                    boxShadow: {
                        'heo': '0 8px 16px -4px rgba(44, 45, 48, 0.047)',
                        'heo-hover': '0 12px 24px -6px rgba(44, 45, 48, 0.1)',
                    }
                }
            }
        }
    </script>
    <style>
        body {
            background-color: #f0f2f5;
        }

        /* 动画过渡 */
        .card-container {
            transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
        }
        .card-container:hover {
            transform: translateY(-4px);
            box-shadow: 0 12px 24px -6px rgba(74, 160, 154, 0.15);
        }

        /* 右侧切换动画 */
        .right-panel-content {
            transition: opacity 0.3s ease, transform 0.3s ease;
        }
        
        /* 隐藏滚动条 */
        ::-webkit-scrollbar {
            display: none;
        }

        /* 进度条动画 */
        .progress-fill {
            transition: width 1s cubic-bezier(0.4, 0, 0.2, 1);
        }

        /* 字体微调 */
        .font-num {
            font-feature-settings: "tnum";
            font-variant-numeric: tabular-nums;
        }
    </style>
</head>
<body class="flex items-center justify-center min-h-screen p-4">

    <!-- 核心卡片容器 -->
    <div class="card-container w-[260px] bg-white rounded-xl p-4 shadow-heo border border-gray-100/50 relative overflow-hidden group select-none">
        
        <!-- 头部标题 -->
        <div class="flex items-center gap-2 mb-4 text-text-main opacity-90">
            <i class="fa-regular fa-clock text-theme-main"></i>
            <span class="text-sm font-bold tracking-wide">倒计时</span>
        </div>

        <!-- 内容区域：左右布局 -->
        <div class="flex items-stretch h-[110px]">
            
            <!-- 左侧：主要倒计时 -->
            <div class="w-[45%] flex flex-col justify-between pr-2 shrink-0">
                <div>
                    <div class="text-[10px] text-text-muted mb-0.5">距离</div>
                    <div class="text-sm font-bold text-text-main leading-tight" id="anniversary-title">建站二周年</div>
                </div>
                
                <div class="mt-1">
                    <div class="text-[40px] font-display font-bold text-theme-main leading-none tracking-tight" id="days-remaining">0</div>
                </div>
                
                <div class="mt-auto">
                    <div class="inline-block bg-gray-100/80 text-text-muted text-[10px] px-1.5 py-0.5 rounded-[4px] font-display" id="next-date">
                        0000-00-00
                    </div>
                </div>
            </div>

            <!-- 中间分割线 -->
            <div class="w-[1px] bg-gray-100 my-1 mx-1"></div>

            <!-- 右侧：进度条/剩余时间 (Hover切换) -->
            <div class="flex-1 pl-2 relative overflow-hidden flex flex-col justify-center">
                
                <!-- 状态 A: 默认显示百分比进度条 -->
                <div id="view-progress" class="absolute inset-0 flex flex-col justify-between py-0.5 transition-all duration-300 opacity-100 translate-x-0 group-hover:opacity-0 group-hover:translate-x-4 pointer-events-none group-hover:pointer-events-none">
                    <!-- 今日 -->
                    <div class="flex justify-between items-center gap-2">
                        <span class="text-xs text-text-sub shrink-0 w-6">今日</span>
                        <div class="flex-1 h-[18px] bg-gray-100 rounded-full relative overflow-hidden">
                            <div id="bar-today" class="h-full bg-theme-main rounded-full progress-fill opacity-90" style="width: 0%"></div>
                            <span id="text-today" class="absolute inset-0 flex items-center justify-center text-[10px] scale-90 font-bold text-text-sub">0%</span>
                        </div>
                    </div>
                    <!-- 本周 -->
                    <div class="flex justify-between items-center gap-2">
                        <span class="text-xs text-text-sub shrink-0 w-6">本周</span>
                        <div class="flex-1 h-[18px] bg-gray-100 rounded-full relative overflow-hidden">
                            <div id="bar-week" class="h-full bg-theme-main rounded-full progress-fill opacity-80" style="width: 0%"></div>
                            <span id="text-week" class="absolute inset-0 flex items-center justify-center text-[10px] scale-90 font-bold text-text-sub">0%</span>
                        </div>
                    </div>
                    <!-- 本月 -->
                    <div class="flex justify-between items-center gap-2">
                        <span class="text-xs text-text-sub shrink-0 w-6">本月</span>
                        <div class="flex-1 h-[18px] bg-gray-100 rounded-full relative overflow-hidden">
                            <div id="bar-month" class="h-full bg-theme-main rounded-full progress-fill opacity-70" style="width: 0%"></div>
                            <span id="text-month" class="absolute inset-0 flex items-center justify-center text-[10px] scale-90 font-bold text-text-sub">0%</span>
                        </div>
                    </div>
                    <!-- 本年 -->
                    <div class="flex justify-between items-center gap-2">
                        <span class="text-xs text-text-sub shrink-0 w-6">本年</span>
                        <div class="flex-1 h-[18px] bg-gray-100 rounded-full relative overflow-hidden">
                            <div id="bar-year" class="h-full bg-theme-main rounded-full progress-fill opacity-60" style="width: 0%"></div>
                            <span id="text-year" class="absolute inset-0 flex items-center justify-center text-[10px] scale-90 font-bold text-text-sub">0%</span>
                        </div>
                    </div>
                </div>

                <!-- 状态 B: Hover显示剩余时间 (Badge样式) -->
                <div id="view-remaining" class="absolute inset-0 flex flex-col justify-between py-0.5 transition-all duration-300 opacity-0 -translate-x-4 group-hover:opacity-100 group-hover:translate-x-0">
                    <!-- 今日 -->
                    <div class="flex justify-between items-center">
                        <span class="text-xs text-text-sub">今日</span>
                        <span id="rem-today" class="text-[11px] font-bold text-theme-main bg-theme-sub px-2 py-0.5 rounded-md font-display">0h</span>
                    </div>
                    <!-- 本周 -->
                    <div class="flex justify-between items-center">
                        <span class="text-xs text-text-sub">本周</span>
                        <span id="rem-week" class="text-[11px] font-bold text-theme-main bg-theme-sub px-2 py-0.5 rounded-md font-display">0d</span>
                    </div>
                    <!-- 本月 -->
                    <div class="flex justify-between items-center">
                        <span class="text-xs text-text-sub">本月</span>
                        <span id="rem-month" class="text-[11px] font-bold text-theme-main bg-theme-sub px-2 py-0.5 rounded-md font-display">0d</span>
                    </div>
                    <!-- 本年 -->
                    <div class="flex justify-between items-center">
                        <span class="text-xs text-text-sub">本年</span>
                        <span id="rem-year" class="text-[11px] font-bold text-theme-main bg-theme-sub px-2 py-0.5 rounded-md font-display">0d</span>
                    </div>
                </div>

            </div>
        </div>
    </div>

    <script>
        // ================= 配置区域 =================
        const config = {
            startDate: '2025-06-10' // 你的建站日期
        };
        // ===========================================

        function initWidget() {
            const now = new Date();
            const currentYear = now.getFullYear();

            // --- 1. 左侧：倒计时逻辑 ---
            const nextAnniversary = getNextAnniversary(config.startDate);
            const diffTimeMs = nextAnniversary.date - now;
            const daysRemaining = Math.max(0, Math.ceil(diffTimeMs / (1000 * 60 * 60 * 24)));

            document.getElementById('anniversary-title').innerText = `建站${numberToChinese(nextAnniversary.yearCount)}周年`;
            document.getElementById('days-remaining').innerText = daysRemaining;
            document.getElementById('next-date').innerText = formatDate(nextAnniversary.date);

            // --- 2. 右侧：百分比计算 ---
            const todaySec = getSecondsToday(now);
            const todayPct = (todaySec / 86400) * 100;

            const dayOfWeek = now.getDay() || 7; // 1-7 (Mon-Sun)
            const weekSec = ((dayOfWeek - 1) * 86400) + todaySec;
            const weekPct = (weekSec / (7 * 86400)) * 100;

            const daysInMonth = new Date(currentYear, now.getMonth() + 1, 0).getDate();
            const monthSec = ((now.getDate() - 1) * 86400) + todaySec;
            const monthPct = (monthSec / (daysInMonth * 86400)) * 100;

            const daysInYear = isLeapYear(currentYear) ? 366 : 365;
            const startOfYear = new Date(currentYear, 0, 1);
            const dayOfYear = Math.floor((now - startOfYear) / (1000 * 60 * 60 * 24));
            const yearSec = (dayOfYear * 86400) + todaySec;
            const yearPct = (yearSec / (daysInYear * 86400)) * 100;

            // 更新进度条
            updateBar('today', todayPct);
            updateBar('week', weekPct);
            updateBar('month', monthPct);
            updateBar('year', yearPct);

            // --- 3. 右侧：剩余时间计算 ---
            document.getElementById('rem-today').innerText = `还剩 ${(24 - todaySec/3600).toFixed(0)} 小时`;
            document.getElementById('rem-week').innerText = `还剩 ${(7 - weekSec/86400).toFixed(0)} 天`;
            document.getElementById('rem-month').innerText = `还剩 ${(daysInMonth - monthSec/86400).toFixed(0)} 天`;
            document.getElementById('rem-year').innerText = `还剩 ${(daysInYear - yearSec/86400).toFixed(0)} 天`;
        }

        // === 工具函数 ===

        function getNextAnniversary(startStr) {
            const now = new Date();
            const startDate = new Date(startStr);
            const currentYear = now.getFullYear();
            
            // 今年的纪念日
            let targetDate = new Date(startStr);
            targetDate.setFullYear(currentYear);

            // 如果今年的纪念日已经过了，就算明年的
            if (now > targetDate) {
                targetDate.setFullYear(currentYear + 1);
            }

            const yearCount = targetDate.getFullYear() - startDate.getFullYear();
            return { date: targetDate, yearCount: yearCount };
        }

        function getSecondsToday(now) {
            return now.getHours() * 3600 + now.getMinutes() * 60 + now.getSeconds();
        }

        function isLeapYear(year) {
            return (year % 4 === 0 && year % 100 !== 0) || (year % 400 === 0);
        }

        function updateBar(id, pct) {
            const bar = document.getElementById(`bar-${id}`);
            const text = document.getElementById(`text-${id}`);
            const pctStr = Math.min(100, Math.max(0, pct)).toFixed(0) + '%';
            
            if(bar) bar.style.width = `${pct}%`;
            
            if(text) {
                text.innerText = pctStr;
                // 进度条颜色反转逻辑：如果进度很长，文字变白
                if (pct > 55) {
                    text.classList.remove('text-text-sub');
                    text.classList.add('text-white');
                } else {
                    text.classList.remove('text-white');
                    text.classList.add('text-text-sub');
                }
            }
        }

        function numberToChinese(num) {
            const chnNumChar = ["零","一","二","三","四","五","六","七","八","九"];
            if(num < 10) return chnNumChar[num];
            if(num === 10) return "十";
            if(num < 20) return "十" + chnNumChar[num % 10];
            return num; 
        }

        function formatDate(date) {
            const y = date.getFullYear();
            const m = String(date.getMonth() + 1).padStart(2, '0');
            const d = String(date.getDate()).padStart(2, '0');
            return `${y}-${m}-${d}`;
        }

        // 初始化并定时更新
        initWidget();
        setInterval(initWidget, 1000);

    </script>
</body>
</html>